
Процедура СформироватьФайл() Экспорт

	
	Запрос = Новый Запрос;
	// +++ # 124 79Vlad  10.10.2018
	//Запрос.Текст = "ВЫБРАТЬ
	//|	узЗадачи.Код КАК НомерЗадачи,
	//|	узЗадачи.Наименование КАК Наименование,
	//|	узЗадачи.Исполнитель.узКороткоеИмя КАК ИсполнительузКороткоеИмя,
	//|	узЗадачи.ОсновнаяЗадача КАК ОсновнаяЗадача
	//|ИЗ
	//|	Справочник.узЗадачи КАК узЗадачи
	//|
	//|УПОРЯДОЧИТЬ ПО
	//|	НомерЗадачи";

	
	Запрос.Текст = "ВЫБРАТЬ
	|	узЗадачи.Код КАК НомерЗадачи,
	|	узЗадачи.Наименование КАК Наименование,
	|	узЗадачи.Исполнитель.узКороткоеИмя КАК ИсполнительузКороткоеИмя,
	|	узЗадачи.ОсновнаяЗадача КАК ОсновнаяЗадача
	|ИЗ
	|	Справочник.узЗадачи КАК узЗадачи
	|ГДЕ
	|	ВЫБОР
	|			КОГДА &ИспользоватьОтборПоКонфигурации
	|				ТОГДА узЗадачи.Конфигурация = &узКонфигурация
	|			ИНАЧЕ ИСТИНА
	|		КОНЕЦ
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерЗадачи";
	
	
	//Установим значения параметров запроса
	Запрос.УстановитьПараметр("узКонфигурация",узКонфигурация);
	ИспользоватьОтборПоКонфигурации = Ложь;
	Если ЗначениеЗаполнено(узКонфигурация)
		И узКонфигурация.узФормироватьФайлСОтборомПоКонфигурации Тогда
		ИспользоватьОтборПоКонфигурации = Истина;
	Конецесли;
	Запрос.УстановитьПараметр("ИспользоватьОтборПоКонфигурации",ИспользоватьОтборПоКонфигурации);
	// --- # 124 79Vlad  10.10.2018

	РезультатЗапроса = Запрос.Выполнить();
	
	Если РезультатЗапроса.Пустой() Тогда
		Возврат;
	Конецесли;
	
	Выборка = РезультатЗапроса.Выбрать();
	
	ИмяФайла = ПапкаДляВыгрузки + "\ListTasks.txt"; 
	ФайлСЗадачами = Новый ЗаписьТекста(ИмяФайла, КодировкаТекста.UTF8); 	
	Пока Выборка.Следующий() Цикл
		
		пНаименование = СокрЛП(Выборка.Наименование);
		пНаименование = СтрЗаменить(пНаименование, "#","№");
		
		пТекстЗадачи = "#"+Формат(Выборка.НомерЗадачи,"ЧГ=0");
		пТекстЗадачи = пТекстЗадачи + " " + пНаименование;
		
		Если ЗначениеЗаполнено(Выборка.ИсполнительузКороткоеИмя) Тогда
			пТекстЗадачи = пТекстЗадачи + " | " + СокрЛП(Выборка.ИсполнительузКороткоеИмя);
		Конецесли;
		Если ЗначениеЗаполнено(Выборка.ОсновнаяЗадача) Тогда
			пТекстЗадачи = пТекстЗадачи + " | " + СокрЛП(Выборка.ОсновнаяЗадача);
		Конецесли;
		
		ФайлСЗадачами.ЗаписатьСтроку(пТекстЗадачи); 	
	КонецЦикла;
	
	ФайлСЗадачами.Закрыть(); 
	Сообщить("Сформирован файл - " + ИмяФайла);
КонецПроцедуры 