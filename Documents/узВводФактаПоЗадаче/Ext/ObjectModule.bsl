
Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	
	НаборЗаписей = Движения.узФактПоЗадачам;
	НаборЗаписей.Записывать = Истина;
	
	Для каждого СтрокаДанные из Данные цикл
		
		Запись = НаборЗаписей.Добавить();		
		Запись.Период = Дата;
		Запись.Задача = Задача;
		Запись.Исполнитель = Исполнитель;
		Запись.Спринт = СтрокаДанные.Спринт;
		Запись.ДатаНачала = СтрокаДанные.ДатаНачала;
		Запись.ДатаОкончания = СтрокаДанные.ДатаОкончания;
		
		// +++ 79Vlad  25.10.2018
		Запись.Примечание = СокрЛП(СтрокаДанные.Примечание);
		// --- 79Vlad  25.10.2018
		
		Запись.Факт = СтрокаДанные.Факт;
	Конеццикла;
	
КонецПроцедуры

Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
	
	Если ПараметрыСеанса.узЗапретитьВводФактаДляОсновныхЗадач Тогда
		ЭтоЗадачаПроекта = ЗначениеЗаполнено(Задача.ОсновнаяЗадача);
		
		Если ЭтоЗадачаПроекта = Ложь Тогда
			
			Отказ = Истина;
			СообщениеОшибки = Новый СообщениеПользователю();
			СообщениеОшибки.Текст = "Для задачи - проекта нет возможности ввода данных о факте работ!";
			СообщениеОшибки.Поле = Ссылка;
			СообщениеОшибки.ПутьКДанным = "Объект.Задача";
			СообщениеОшибки.Сообщить();
			
		КонецЕсли;
		
		Если Справочники.узЗадачи.ЗадачаБезПодчененнойИерархии(Задача) Тогда 
			Отказ = Истина;
			СообщениеОшибки = Новый СообщениеПользователю();
			СообщениеОшибки.Текст = "Для задачи, которая имеет подчиненные задачи,  нет возможности ввода данных о факте работ!";
			СообщениеОшибки.Поле = Ссылка;
			СообщениеОшибки.ПутьКДанным = "Объект.Задача";
			СообщениеОшибки.Сообщить();
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

